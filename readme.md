# 文学句子提取工具

这是一个基于AI大模型的文学句子提取工具，可以从PDF和EPUB文件中自动提取具有文学性的句子。支持多种AI模型，包括OpenAI、Deepseek、文心一言和通义千问。

## 功能特点

1. **多模型支持**：
   - OpenAI (GPT-3.5-turbo)
   - Deepseek
   - 百度文心一言
   - 阿里通义千问

2. **文件处理**：
   - 支持PDF和EPUB格式
   - 智能处理跨页文本
   - 支持批量处理多个文件
   - 文件选择更灵活，可从任意位置导入

3. **灵活的处理选项**：
   - 支持指定页码范围处理
   - 提供两种存储模式：
     * 实时追加模式
     * 批量处理模式
   - 可自定义处理间隔

4. **测试界面**：
   - 提供图形化测试界面
   - 支持实时测试不同模型
   - 可自定义系统提示词
   - 支持保存和管理提示词模板
   - 快速切换不同场景的提示词

## 目录结构

```
项目根目录/
├── sep_pages/      # 存放分页数据
├── output/         # 存放处理结果
│   └── 书籍名称/   # 每本书单独一个目录
├── main.py         # 主程序
├── pdf_parse.py    # PDF解析模块
├── epub_parse.py   # EPUB解析模块
├── extract_literary.py  # 文学句子提取模块
└── test_interface.py   # 测试界面
```

## 使用方法

### 1. 环境准备
```bash
# 安装依赖
pip install -r requirements.txt
```

### 2. 启动方式

#### 方式一：图形界面（推荐）
```bash
python main_gui.py
```
- 提供完整的图形操作界面
- 支持文件拖放和选择
- 可视化配置和处理
- 实时显示处理进度
- 更直观的操作体验

#### 方式二：命令行界面
```bash
python main.py
```
- 适合命令行操作
- 支持批处理
- 适合自动化脚本调用

### 3. 基本使用流程

#### 图形界面使用流程：

1. **启动程序**：
   - 运行 `main_gui.py`
   - 等待主界面加载

2. **选择输入文件**：
   - 点击"从系统选择"按钮
   - 在文件选择对话框中选择要处理的文件
   - 支持选择多个PDF或EPUB文件
   - 选中的文件会自动复制到工作目录

3. **配置处理选项**：
   - 选择AI模型
   - 输入API密钥
   - 选择存储模式
   - 设置处理页码范围（可选）

4. **开始处理**：
   - 点击"开始处理"按钮
   - 在进度条中查看处理进度
   - 处理完成后自动保存结果

#### 命令行使用流程：

1. **启动程序**：
   ```bash
   python main.py
   ```

2. **按提示操作**：
   - 选择AI模型
   - 输入API密钥
   - 选择存储模式
   - 指定处理页码范围

### 3. 存储模式说明

1. **追加模式**（默认）：
   - 边处理边保存结果
   - 结果直接追加到最终文件
   - 适合处理小型文档

2. **批量模式**：
   - 按指定页数间隔保存
   - 自动合并最终结果
   - 适合处理大型文档
   - 支持断点续传

### 4. 使用测试界面

运行测试界面：
```bash
python test_interface.py
```

测试界面功能：
- 选择不同的AI模型
- 配置API密钥
- 自定义系统提示词
- 快速测试文本处理效果
- **提示词模板管理**：
  * 保存常用提示词为模板
  * 快速切换不同模板
  * 支持模板的添加、删除和修改
  * 模板数据持久化存储

## 输出说明

1. **文件命名**：
   - 格式：`书名_pages_起始页-结束页_literary.txt`
   - 示例：`book_pages_1-50_literary.txt`

2. **输出内容**：
   - 每页内容以分隔符标注
   - 按页码顺序排列
   - 仅包含提取出的文学句子

## 注意事项

1. **API密钥**：
   - 需要提前准备相应模型的API密钥
   - 密钥信息保存在 `config.json` 中
   - 请妥善保管API密钥

2. **处理限制**：
   - 建议根据文档大小选择合适的存储模式
   - 批量模式建议每10页保存一次
   - 注意API调用频率限制

3. **错误处理**：
   - 程序会自动创建必要的目录
   - 处理错误时会保留已完成的结果
   - 支持断点续传功能

## 开发说明

1. **添加新模型**：
   - 继承 `ModelAdapter` 基类
   - 实现 `extract_sentences` 方法
   - 在 `create_model_adapter` 中注册

2. **自定义提示词**：
   - 可在测试界面中修改
   - 默认提示词注重文学性特征
   - 支持实时调整和测试
   - 提供模板管理功能：
     * 模板存储在 `prompt_templates.json` 中
     * 支持多场景提示词快速切换
     * 便于管理和复用常用提示词

## 常见问题

1. **文件处理问题**：
   - 支持PDF和EPUB格式文件
   - 可以从任意位置选择文件
   - 选中的文件会自动复制到工作目录

2. **API调用失败**：
   - 验证API密钥是否正确
   - 检查网络连接
   - 确认API余额充足

3. **处理中断**：
   - 使用批量模式可以从断点继续
   - 检查错误日志
   - 可以指定页码范围重新处理

